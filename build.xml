<?xml version="1.0" encoding="UTF-8"?>
<project name="gxp" default="dist">

    <description>
        GXP Build File
    </description>

    <property name="src" location="src"/>
    <property name="build" location="build"/>

    <target name="init">
        <mkdir dir="${build}"/>

        <echo message="pulling in ringo (ignore fatal warning)"/>
        <mkdir dir="${build}/ringo"/>
        <exec executable="git" dir="${build}/ringo" failonerror="false">
            <arg line="clone -nq git://github.com/ringo/ringojs.git ."/>
        </exec>
        <exec executable="git" dir="${build}/ringo" failonerror="true">
            <arg line="pull origin master"/>
        </exec>
        <exec executable="git" dir="${build}/ringo" failonerror="true">
            <arg line="checkout 7af8f2bba20890e4860973fea5254b55bd00c7d7"/>
        </exec>

        <echo message="building ringo jars"/>
        <ant dir="${build}/ringo" target="jar" inheritAll="false"/>

        <echo message="pulling in buildkit (ignore fatal warning)"/>
        <mkdir dir="${build}/buildkit"/>
        <exec executable="git" dir="${build}/buildkit" failonerror="false">
            <arg line="clone -nq git://github.com/tschaub/buildkit.git ."/>
        </exec>
        <exec executable="git" dir="${build}/buildkit" failonerror="true">
            <arg line="pull origin master"/>
        </exec>
        <exec executable="git" dir="${build}/buildkit" failonerror="true">
            <arg line="checkout 86eacbd7b3bf62b8e99f46911dd5a633464b8570"/>
        </exec>

        <echo message="pulling in submodules"/>
        <exec executable="git" failonerror="true">
            <arg line="submodule init"/>
        </exec>
        <exec executable="git" failonerror="true">
            <arg line="submodule sync"/>
        </exec>
        <exec executable="git" failonerror="true">
            <arg line="submodule update"/>
        </exec>

    </target>
    
    <target name="parsedocs" description="parse docs source from scripts">
        <echo>Parsing doc sources.</echo>
        <exec executable="jst" failonerror="true">
            <arg value="jst.cfg"/>
        </exec>
    </target>
    
    <target name="doc" depends="init, parsedocs" description="build documentation">
        <echo>Building docs.</echo>
        <exec executable="sphinx-build" failonerror="true">
            <arg line="-b html"/>
            <arg value="-d"/>
            <arg path="${src}/doc/_build/doctrees"/>
            <arg path="${src}/doc"/>
            <arg path="${build}/doc"/>
        </exec>
    </target>

    <target name="dist" depends="clean, init, doc" description="prepare lib for distribution">
        <echo>Preparing for distribution.</echo>
    </target>

    <target name="clean" description="remove previous build">
        <delete dir="${build}/doc"/>
    </target>

</project>
    
