
.. currentmodule:: gxp.plugins

:class:`gxp.plugins.FeatureManager`
================================================================================


.. cssclass:: meta


Extends
    * `Ext.util.Observable <http://extjs.com/deploy/dev/docs/?class=Ext.util.Observable>`_
    * :class:`gxp.plugins.Tool`





ptype
    ``gx_featuremanager``



.. class:: FeatureManager(config)

  Plugin for a shared feature manager that other tools can reference. Works
  on layers added by the :class:`gxp.plugins.WMSSource` plugin, if there is
  a WFS resource advertized in the layer's DescribeLayer document.

  The FeatureManager handles WFS feature loading, filtering, paging and
  transactions.


    


Config Options
--------------

Configuration properties in addition to
those listed for `Ext.util.Observable <http://extjs.com/deploy/dev/docs/?class=Ext.util.Observable>`_.


.. describe:: actions

    ``Array`` Custom actions for tools that do not provide their own. Array
    elements are expected to be valid Ext config objects. Actions provided
    here may have an additional ``menuText`` property, which will be used
    as text when the action is used in a menu. The ``text`` property will
    only be used in buttons. Optional, only needed to create custom
    actions.

.. describe:: actionTarget

    ``String`` or ``Array`` Where to place the tool's actions (e.g. buttons
    or menus)? This can be any string that references an ``Ext.Container``
    property on the portal, or a unique id configured on a component, or an
    array of the aforementioned if the action is to be put in more than one
    places (e.g. a button and a context menu item). To reference one of the
    toolbars of an ``Ext.Panel``, ".tbar", ".bbar" or ".fbar" has to be
    appended. The default is "map.tbar". The viewer's main MapPanel
    can always be accessed with "map" as actionTarget. Set to null if no
    actions should be created.

.. describe:: appendActions

    ``Boolean`` If set to false, actions won't be added, but inserted to
    the container at the beginning. This is useful to control the order of
    actions in a toolbar. Default is true.

.. describe:: autoLoadFeatures

    ``Boolean`` Automatically load features after a new layer has been set?
    Default is false.

.. describe:: autoSetLayer

    ``Boolean`` Listen to the viewer's layerselectionchange event to
    automatically set the layer? Default is true.

.. describe:: defaultAction

    ``Number`` Optional index of an action that should be active by
    default. Only works for actions that are a ``GeoExt.Action`` instance.

.. describe:: format

    ``String`` Optional response format to use for WFS GetFeature requests.
    Valid values are "GML2", "GML3" and "JSON". By default this is not set,
    which means that GML3 will be used.

.. describe:: maxFeatures

    ``Number`` Default is 100

.. describe:: outputAction

    ``Number`` The ``actions`` array index of the action that should
    trigger this tool's output. Only valid if ``actions`` is configured.
    Leave this unconfigured if none of the ``actions`` should trigger this
    tool's output.

.. describe:: outputConfig

    ``Object`` Optional configuration for the output container. This may
    be useful to override the xtype (e.g. "window" instead of "gx_popup"),
    or to provide layout configurations when rendering to an
    ``outputTarget``.

.. describe:: outputTarget

    ``String`` Where to add the tool's output container? This can be any
    string that references an ``Ext.Container`` property on the portal, or
    "map" to access the viewer's main map. If not provided, a window will
    be created.

.. describe:: paging

    ``Boolean`` Should quad-tree paging be enabled? Default is true.

.. describe:: symbolizer

    ``Object`` An object with "Point", "Line" and "Polygon" properties,
    each with a valid symbolizer object for OpenLayers. Will be used to
    render features.

.. describe:: toggleGroup

    ``String`` If this tool should be radio-button style toggled with other
    tools, this string is to identify the toggle group.




Public Properties
-----------------

Public properties in addition to those
listed for `Ext.util.Observable <http://extjs.com/deploy/dev/docs/?class=Ext.util.Observable>`_.


.. attribute:: FeatureManager.featureLayer

    ``OpenLayers.Layer.Vector`` The layer associated with this tool's
    featureStore.

.. attribute:: FeatureManager.featureStore

    :class:`gxp.data.WFSFeatureStore` The FeatureStore that this tool
    manages.

.. attribute:: FeatureManager.geometryType

    ``String`` The geometry type of the featureLayer

.. attribute:: FeatureManager.layerRecord

    ``GeoExt.data.LayerRecord`` The currently selected layer for this
    FeatureManager

.. attribute:: FeatureManager.schema

    ``GeoExt.data.AttributeStore`` or false if the ``featureLayer`` has no
     associated WFS FeatureType, or null if no layer is currently selected.




Public Methods
--------------

Public methods in addition to those
listed for `Ext.util.Observable <http://extjs.com/deploy/dev/docs/?class=Ext.util.Observable>`_.


.. method:: FeatureManager.addActions

    :arg actions: ``Array`` Optional actions to add. If not provided,
        this.actions will be added.
    :returns: ``Array`` The actions added.

.. method:: FeatureManager.addOutput

    

.. method:: FeatureManager.hideLayer

    :arg id: ``String`` id of a tool that no longer needs to show this
        tool's featureLayer. The layer will be hidden if no more tools need
        to show it.

.. method:: FeatureManager.loadFeatures

    :arg filter: ``OpenLayers.Filter`` Optional filter for the GetFeature
        request.
    :arg callback: ``Function`` Optional callback to call when the
        features are loaded. This function will be called with the array
        of the laoded features (``OpenLayers.Feature.Vector``) as argument.
    :arg scope: ``Object`` Optional scope for the callback function.

.. method:: FeatureManager.nextPage

    :arg callback: ``Function`` Optional callback to call when the page
        is available. The callback will receive the page as 1st argument.
    :arg scope: ``Object`` Optional scope for the callback.
    
    Load the next page.

.. method:: FeatureManager.previousPage

    :arg callback: ``Function`` Optional callback to call when the page
        is available. The callback will receive the page as 1st argument.
    :arg scope: ``Object`` Optional scope for the callback.
    
    Load the previous page.

.. method:: FeatureManager.setLayer

    :arg layerRecord: ``GeoExt.data.LayerRecord``
    :returns: ``Boolean`` The layer was changed.
    
    Sets the layer for this tool

.. method:: FeatureManager.setPage

    :arg condition: ``Object`` Object to tell the method which page to set.
        If "lonLat" (``OpenLayers.LonLat``) is provided, the page
        containing the provided location will be loaded.
        If only an "index" property (pointing to a page in this tool's
        pages array) is provided, the method will load the according page
        if it has less then ``maxFeatures`` features. If it does not,
        leaves will be created until the top-left page has less than
        ``maxFeatures``, and this top-left page will be loaded. If index is
        "last", the last page of the quad-tree will be loaded. If an
        additional "next" property is provided (a page object is expected
        here), the page that would be loaded with ``previousPage`` called
        from the provided page will be set. This is the bottom-right page
        of the page pointed to with "index".
        If the resulting page would be empty, and "allowEmpty" is false,
        the next matching page will be loaded.
    :arg callback: ``Function`` Optional callback to call when the page
        is available. The callback will receive the page as 1st argument.
    :arg scope: ``Object`` Optional scope for the callback.
    
    Sets and loads the page specified by the condition argument. This is
    usually used to load a page for a specific location, or to load the
    first or last page of the quad tree.
    
    Sample code to load the page that contains the (0, 0) location:
    
    .. code-block:: javascript
    
        featureManager.setPage({lonLat: new OpenLayers.LonLat(0, 0)});
    
    Sample code to load the first page of the quad-tree:
    
    .. code-block:: javascript
    
        featureManager.setPage({index: 0});
    
    Sample code to load the last page of the quad-tree:
    
    .. code-block:: javascript
    
        featureManager.setPage({index: "last"});
    
    Sample code to load the first page that contains features:
    
    .. code-block:: javascript
    
        featureManager.setPage();

.. method:: FeatureManager.showLayer

    :arg id: ``String`` id of a tool that needs to show this tool's
        featureLayer.
    :arg display: ``String`` "all" or "selected". Optional, default is
        "all"




Events
------

Events in addition to those
listed for `Ext.util.Observable <http://extjs.com/deploy/dev/docs/?class=Ext.util.Observable>`_.


.. describe:: beforelayerchange

    Fired before a layer change results in destruction of the
    current featureStore, and creation of a new one. This event
    can be used to abort the setLayer method before any action is
    performed, by having a listener return false.
    
    Listener arguments:
    
    * tool  - :class:`gxp.plugins.FeatureManager` this tool
    * layer - ``GeoExt.data.LayerRecord`` the layerRecord argument
      passed to the setLayer method

.. describe:: beforequery

    Fired before a WFS GetFeature request is issued. This event
    can be used to abort the loadFeatures method before any action
    is performed, by having a listener return false.
    
    Listener arguments:
    
    * tool   - :class:`gxp.plugins.FeatureManager` this tool
    * filter - ``OpenLayers.Filter`` the filter argument passed to
      the loadFeatures method
    * callback - ``Function`` the callback argument passed to the
      loadFeatures method
    * scope - ``Object`` the scope argument passed to the
      loadFeatures method

.. describe:: beforsetpage

    Fired if paging is on, before a different page is requested. This
    event can be used to abort the setPage method before any action
    is performed, by having a listener return false.
    
    Listener arguments:
    
    * tool      - :class:`gxp.plugins.FeatureManager` this tool
    * condition - ``Object`` the condition passed to the setPage
      method
    * callback  - ``Function`` the callback argument passed to the
      setPage method
    * scope     - ``Object`` the scope argument passed to the
      setPage method

.. describe:: layerchange

    Fired after a layer change, as soon as the layer's schema is
    available.
    
    Listener arguments:
    
    * tool   - :class:`gxp.plugins.FeatureManager` this tool
    * layer  - ``GeoExt.data.LayerRecord`` the new layer
    * schema - ``GeoExt.data.AttributeStore`` or false if the
      layer has no associated WFS FeatureType, or null if no layer
      is currently selected.

.. describe:: query

    Fired after a WFS GetFeature query, when the results are
    available.
    
    Listener arguments:
    
    * tool  - :class:`gxp.plugins.FeatureManager` this tool
    * store - :class:`gxp.data.WFSFeatureStore`

.. describe:: setpage

    Fired if paging is on, when a different page is set, but before
    its features are loaded.
    
    Listener arguments:
    
    * tool      - :class:`gxp.plugins.FeatureManager` this tool
    * condition - ``Object`` the condition passed to the setPage
      method
    * callback  - ``Function`` the callback argument passed to the
      setPage method
    * scope     - ``Object`` the scope argument passed to the
      setPage method



